# SOW（Statement of Work）  
## アイスブレイ君

### 1. プロジェクト概要
- **目的**: チームの毎朝のアイスブレイクスピーチにおける当番管理を効率化し、業務の透明性・公平性を向上させる。
- **背景**: 現状、当番の割り当てや連絡が手作業で行われており、煩雑・非効率な状況となっている。


### 2. 機能一覧
- チームメンバーの追加・削除・編集
- 当番の自動割り当て
  - 割り当てボタンを押したら1週間の当番表が作成される
  - 割り当てボタンを押したらslackに通知される
    - チャンネルIDはC095GP97S90
- 生成AIを活用したスピーチネタの提案機能

### 3. 非機能要件
- シンプルで直感的なUI

### 4. 生成AI活用ポイント
- スピーチネタの自動生成・提案
- 業務自動化シナリオの提案
- ユーザーからの問い合わせに対するAIチャット対応（必要に応じて）


### 5. 開発体制
Aさん
Bさん
Cさん
Dさん
Eさん
Fさん

### インフラ構成

#### アーキテクチャ概要
本システムは、AWS上にコンテナベースのマイクロサービス型アーキテクチャで構築されています。Slack通知機能を中心とした非同期メッセージング処理により、スケーラブルで信頼性の高いシステムを実現しています。

#### 詳細構成

**1. ネットワーク層**
- **VPC**: 10.0.0.0/16 CIDRブロック
- **パブリックサブネット**: 10.0.1.0/24, 10.0.2.0/24（マルチAZ）
- **プライベートサブネット**: 10.0.10.0/24, 10.0.11.0/24（マルチAZ）
- **可用性ゾーン**: ap-northeast-1a, ap-northeast-1c
- **Internet Gateway**: 外部インターネットアクセス
- **セキュリティグループ**: 
  - ALB用（80/443ポート開放）
  - ECS用（ALBからの3000ポートのみ許可）
  - RDS用（ECSからの5432ポートのみ許可）

**2. アプリケーション層**
- **ECS Fargate**: 
  - CPU: 256単位（0.25vCPU）
  - メモリ: 512MB
  - 最小インスタンス数: 1
  - 自動スケーリング対応
- **Application Load Balancer**:
  - インターネット向け
  - ヘルスチェック: /up エンドポイント
  - HTTPトラフィック（HTTP→HTTPS リダイレクト対応可）
- **Docker コンテナ**: Rails 8.0.2アプリケーション

**3. データベース層**
- **RDS PostgreSQL 15.4**:
  - インスタンスタイプ: db.t3.micro
  - ストレージ: 20GB SSD（gp2）
  - 暗号化: 有効
  - 自動バックアップ: 7日間保持
  - メンテナンス: 日曜日 04:00-05:00 JST
  - Multi-AZ配置（本番環境推奨）

**4. Slack通知システム**
- **SQS キュー**:
  - 名前: ice-breakun2-slack-notifications
  - メッセージ保持期間: 14日間
  - 受信待機時間: 10秒（Long Polling）
  - デッドレターキュー: 設定済み
- **Lambda関数**:
  - ランタイム: Python 3.9
  - メモリ: 128MB
  - タイムアウト: 30秒
  - 同時実行数: 制限なし
- **Parameter Store**:
  - Slack Webhook URL（暗号化済み）
  - Slack チャンネル設定

**5. 監視・ログ**
- **CloudWatch Logs**:
  - アプリケーションログ: /ecs/ice-breakun2
  - Lambdaログ: /aws/lambda/ice-breakun2-slack-notifier
  - 保持期間: 30日間
- **CloudWatch Metrics**: 
  - ECS: CPU使用率、メモリ使用率、実行中タスク数
  - RDS: CPU使用率、接続数、空きストレージ
  - Lambda: 実行回数、エラー率、実行時間
  - SQS: メッセージ数、可視性タイムアウト

#### Slack通知フロー詳細
1. **割り当て機能実行**
   - Rails アプリケーションで当番割り当て処理
   - SQSキューにJSONメッセージを送信
   ```json
   {
     "type": "assignment",
     "user_name": "山田太郎",
     "assignment_date": "2024-01-15",
     "assignment_method": "custom"
   }
   ```

2. **Lambda関数処理**
   - SQSイベントトリガーで自動実行
   - バッチサイズ: 10メッセージ
   - Parameter Storeから設定値を取得

3. **Slack通知送信**
   - Incoming Webhook経由でメッセージ送信
   - リッチフォーマット対応（attachments使用）
   - エラーハンドリング・リトライ機能

#### セキュリティ設計

**1. ネットワークセキュリティ**
- プライベートサブネットでのアプリケーション実行
- セキュリティグループによる最小権限通信制御
- NACLによる追加のネットワーク保護

**2. アクセス制御**
- IAMロールによる最小権限アクセス
- ECSタスクロール: SQS送信、Parameter Store読み取り
- Lambda実行ロール: SQS受信、Parameter Store読み取り

**3. データ保護**
- RDS暗号化（保存時・転送時）
- Parameter Store暗号化（KMS使用）
- CloudWatch Logs暗号化

#### スケーラビリティ設計

**1. 水平スケーリング**
- ECS Fargate自動スケーリング
- Lambda同時実行制御
- SQSによる非同期処理

**2. 垂直スケーリング**
- RDSインスタンスタイプ変更対応
- ECSタスク定義のリソース調整

**3. 高可用性**
- Multi-AZ配置
- Application Load Balancerによる冗長化
- 自動故障検知・復旧

#### 運用・管理

**1. インフラ管理**
- **Terraform**: Infrastructure as Code
- **バージョン管理**: 設定変更の履歴管理
- **環境分離**: development/staging/production

**2. デプロイメント**
- **Blue-Green デプロイメント**: ECS サービス更新
- **ローリングアップデート**: ゼロダウンタイム更新
- **ロールバック**: 即座に前バージョンに戻す機能

**3. 監視・アラート**
- **CloudWatch アラーム**: CPU使用率、エラー率監視
- **SNS通知**: 重要なアラートのメール通知
- **ダッシュボード**: 各種メトリクスの可視化

#### 料金構成
**月額概算料金**（東京リージョン）
- **ECS Fargate**: $15-30（使用時間による）
- **RDS PostgreSQL**: $15-20（db.t3.micro）
- **Application Load Balancer**: $18-25
- **Lambda**: $1-5（実行回数による）
- **SQS**: $0.5-2（メッセージ数による）
- **Parameter Store**: $0.5-1
- **CloudWatch**: $5-10
- **その他**: $5-10

**合計**: 約$60-100/月

#### 技術選択の理由

**1. ECS Fargate**
- サーバーレスコンテナ実行環境
- インフラ管理の簡素化
- 自動スケーリング対応

**2. SQS + Lambda**
- 非同期処理による疎結合
- 高い信頼性とスケーラビリティ
- コスト効率の良い従量課金

**3. PostgreSQL**
- ACID特性による高いデータ整合性
- 豊富な機能とパフォーマンス
- Rails との親和性

**4. Parameter Store**
- 機密情報の安全な管理
- 暗号化とアクセス制御
- 他AWSサービスとの統合


# 注意事項
- 各機能はシンプルな実装にすること
